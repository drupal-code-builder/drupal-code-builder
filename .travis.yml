# See https://github.com/travis-ci/travis.rb for linting.
language: php
php:
  # No PHP 5, as phpunit does not support it.
  - 7.1

env:
  # Whether to run DCB's internal tests, or integration tests that require a
  # Drupal build.
  # See https://gist.github.com/jamesarosen/e29076bd81a099f0f72e
  - TESTTYPE=dcb
  - TESTTYPE=drupal

install:
  # Remove xdebug. We aren't generating code coverage, and it slows down Composer.
  - phpenv config-rm xdebug.ini || true
  # Separate script because multiple commands in the YAML are fiddly and buggy.
  - sh -c "./travis-install.sh"
  - ls
  - ls drupal

script:
  # Only run the unit tests; for the integration tests we need a Drupal
  # install.
  - if [ "$TESTTYPE" = "dcb" ]; then vendor/phpunit/phpunit/phpunit Test/Unit; fi
  # Run the integration tests with Drupal's PHPUnit.
  - if [ "$TESTTYPE" = "drupal" ]; then cd drupal; ./vendor/bin/phpunit -c core vendor/drupal-code-builder/drupal-code-builder/Test/Integration/CollectPluginInfoTest.php; fi
